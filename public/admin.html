<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.4/firebase-database-compat.js"></script>

<style>
:root{
  --primary:#2563eb;
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
  --danger:#dc2626;
  --warn:#f59e0b;
  --ok:#16a34a;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial,sans-serif;
  background:linear-gradient(180deg,#f8fafc,#eef2f7);
}
.login-wrap{position:fixed;inset:0;display:flex;align-items:center;justify-content:center}
.login-card{max-width:420px;width:100%;background:#fff;padding:42px;border-radius:18px;border:1px solid var(--border);text-align:center}
#panel{display:none}
.container{max-width:1200px;margin:30px auto;padding:0 16px}
.card{background:#fff;border-radius:14px;border:1px solid var(--border);padding:22px;margin-bottom:20px}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);font-size:14px}
th{background:#f9fafb}
input,select,button{padding:8px;border-radius:6px}
button{border:none;color:#fff;font-weight:600;cursor:pointer}
.primary{background:var(--primary)}
.warning{background:var(--warn)}
.danger{background:var(--danger)}
.gray{background:#6b7280}
.flex{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
.badge{background:#eef2ff;padding:6px 14px;border-radius:999px;font-weight:600}
.small{font-size:12px;color:var(--muted)}
</style>
</head>

<body>

<!-- LOGIN -->
<div class="login-wrap" id="loginBox">
  <div class="login-card">
    <h1>Administrator</h1>
    <p>Masukkan PIN</p>
    <input id="pin" type="password">
    <button onclick="login()" class="primary">Login</button>
  </div>
</div>

<!-- PANEL -->
<div id="panel">
  <div class="container">

    <div class="card">
      <h3 id="greeting"></h3>
    </div>

    <div class="card">
      <h3>User Management</h3>
      <div class="flex">
        <input id="u" placeholder="USERNAME" oninput="this.value=this.value.toUpperCase()">
        <input id="s" placeholder="STORE ID" oninput="this.value=this.value.toUpperCase()">
        <input id="d" type="number" placeholder="Masa aktif (hari)">
        <button class="primary" onclick="addUser()">Simpan</button>
        <span class="badge">Total: <span id="total">0</span></span>
      </div>
    </div>

    <div class="card">
      <input id="search" placeholder="Cari..." oninput="render()">
      <select id="filter" onchange="render()">
        <option value="all">Semua</option>
        <option value="active">Aktif</option>
        <option value="soon">Hampir Expired</option>
        <option value="expired">Expired</option>
      </select>
    </div>

    <div class="card">
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Store</th>
            <th>Expired</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>

    <button class="danger" onclick="logout()">Logout</button>
  </div>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAvl_paDtkaHgPM2F1PRtybh_EanGfDT_Q",
  databaseURL:"https://serversetoran-default-rtdb.asia-southeast1.firebasedatabase.app"
});
const db=firebase.database();
const ADMIN_PIN="500000";
const ADMIN_NAME="Pak Imron";
let USERS={};

function login(){
  if(pin.value!==ADMIN_PIN) return alert("PIN salah");
  loginBox.style.display="none";
  panel.style.display="block";
  greeting.innerText="ðŸ‘‹ Selamat datang, "+ADMIN_NAME;
  load();
}

function load(){
  db.ref("userList").on("value",s=>{
    USERS=s.val()||{};
    total.innerText=Object.keys(USERS).length;
    render();
  });
}

function addUser(){
  if(!u.value||!s.value||!d.value) return alert("Lengkapi data");
  const exp=new Date();
  exp.setDate(exp.getDate()+parseInt(d.value));
  db.ref("userList").push({
    username:u.value,
    storeId:s.value,
    expired:exp.toISOString().slice(0,10)
  });
  u.value=s.value=d.value="";
}

function render(){
  list.innerHTML="";
  const q=search.value.toLowerCase();
  const f=filter.value;
  const now=new Date();

  Object.keys(USERS).forEach(id=>{
    const u=USERS[id];
    const exp=new Date(u.expired);
    const diff=Math.ceil((exp-now)/86400000);

    if(q && !u.username.toLowerCase().includes(q) && !u.storeId.toLowerCase().includes(q)) return;
    if(f==="active" && diff<=0) return;
    if(f==="expired" && diff>0) return;
    if(f==="soon" && (diff>7||diff<=0)) return;

    let status=`<span style="color:var(--ok)">Aktif</span>`;
    if(diff<=0) status=`<span style="color:var(--danger)">Expired</span>`;
    else if(diff<=7) status=`<span style="color:var(--warn)">Hampir Expired</span>`;

    list.innerHTML+=`
<tr>
<td>${u.username}</td>
<td>${u.storeId}</td>
<td>${u.expired}</td>
<td>${status}</td>
<td>
<button class="warning" onclick="editUser('${id}')">Edit</button>
<button class="danger" onclick="delUser('${id}')">Hapus</button>
</td>
</tr>`;
  });
}

function editUser(id){
  const dta=USERS[id];
  const nu=prompt("Username:",dta.username);
  const ns=prompt("Store ID:",dta.storeId);
  const add=parseInt(prompt("Tambah masa aktif (hari):",0));
  if(!nu||!ns) return;

  let exp=new Date(dta.expired);
  if(add>0) exp.setDate(exp.getDate()+add);

  db.ref("userList/"+id).update({
    username:nu.toUpperCase(),
    storeId:ns.toUpperCase(),
    expired:exp.toISOString().slice(0,10)
  });
}

function delUser(id){
  if(confirm("Hapus user?")) db.ref("userList/"+id).remove();
}
function logout(){location.reload()}
</script>

</body>
</html>

