<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{
  --primary:#2563eb;
  --bg:#f3f4f6;
  --card:#ffffff;
  --text:#111827;
  --muted:#6b7280;
  --border:#e5e7eb;
  --danger:#dc2626;
}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Inter,Segoe UI,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* ===== LOGIN PIN ===== */
.login-wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-card{
  background:#fff;
  width:100%;
  max-width:360px;
  padding:32px;
  border-radius:16px;
  border:1px solid var(--border);
}
.login-card h1{text-align:center;margin:0 0 6px}
.login-card p{text-align:center;color:var(--muted);margin:0 0 20px}
.login-card input{
  width:100%;
  padding:14px;
  font-size:18px;
  text-align:center;
  letter-spacing:4px;
  border-radius:12px;
  border:1px solid var(--border);
  margin-bottom:14px;
}
.login-card button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:12px;
  background:var(--primary);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}
.error{text-align:center;color:var(--danger);font-size:14px}

/* ===== ADMIN PANEL ===== */
#adminApp{display:none}
.header{
  background:#fff;
  border-bottom:1px solid var(--border);
  padding:16px 20px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.container{
  max-width:1100px;
  margin:30px auto;
  padding:0 16px;
}
.card{
  background:#fff;
  border-radius:14px;
  border:1px solid var(--border);
  padding:20px;
  margin-bottom:20px;
}
table{width:100%;border-collapse:collapse}
th,td{padding:10px;border-bottom:1px solid var(--border);font-size:13px}
button.small{
  padding:6px 10px;
  font-size:12px;
  border:none;
  border-radius:6px;
  cursor:pointer;
}
.primary{background:var(--primary);color:#fff}
.danger{background:var(--danger);color:#fff}
.gray{background:#f3f4f6}
.badge{
  padding:4px 10px;
  border-radius:999px;
  font-size:12px;
}
.on{background:#dcfce7;color:#166534}
.off{background:#fee2e2;color:#991b1b}
</style>
</head>

<body>

<!-- ===== LOGIN PIN ===== -->
<div class="login-wrap" id="loginBox">
  <div class="login-card">
    <h1>üîê Admin Panel</h1>
    <p>Masukkan PIN Admin</p>
    <input id="pin" type="password" maxlength="6" inputmode="numeric" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
    <button onclick="loginAdmin()">Masuk</button>
    <div class="error" id="err"></div>
  </div>
</div>

<!-- ===== ADMIN APP ===== -->
<div id="adminApp">
  <div class="header">
    <h3>Admin Panel</h3>
    <button class="small danger" onclick="logout()">Logout</button>
  </div>

  <div class="container">

    <div class="card">
      <h3>‚ûï Tambah User</h3>
      <form id="addForm">
        <input id="u" placeholder="USERNAME" required>
        <input id="s" placeholder="STORE ID" required>
        <input id="e" type="date" required>
        <select id="r">
          <option value="user">USER</option>
          <option value="admin">ADMIN</option>
        </select>
        <button class="small primary">Simpan</button>
      </form>
    </div>

    <div class="card">
      <h3>üìã Daftar User</h3>
      <table>
        <thead>
          <tr>
            <th>User</th>
            <th>Store</th>
            <th>Expired</th>
            <th>Device</th>
            <th>Status</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>
    </div>

  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
import { getDatabase, ref, onValue, push, update, remove } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-database.js";

/* ===== PIN ADMIN ===== */
const ADMIN_PIN = "500000";

/* ===== FIREBASE CONFIG (PUNYA KAMU) ===== */
const app = initializeApp({
  apiKey: "AIzaSyAvl_paDtkaHgPM2F1PRtybh_EanGfDT_Q",
  databaseURL: "https://serversetoran-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "serversetoran"
});
const db = getDatabase(app);

/* ===== LOGIN LOGIC ===== */
window.loginAdmin = ()=>{
  if(pin.value === ADMIN_PIN){
    sessionStorage.setItem("admin","1");
    loginBox.style.display="none";
    adminApp.style.display="block";
  }else{
    err.textContent="‚ùå PIN salah";
    pin.value="";
  }
};

/* AUTO SHOW IF LOGIN */
if(sessionStorage.getItem("admin")==="1"){
  loginBox.style.display="none";
  adminApp.style.display="block";
}

/* ===== LOAD USER ===== */
onValue(ref(db,"userList"),snap=>{
  list.innerHTML="";
  snap.forEach(c=>{
    const u=c.val();
    list.innerHTML+=`
<tr>
<td>${u.username}</td>
<td>${u.storeId}</td>
<td>${u.expired}</td>
<td>${u.deviceId?"üîí":"-"}</td>
<td><span class="badge ${u.active?"on":"off"}">${u.active?"Aktif":"Off"}</span></td>
<td>
<button class="small gray" onclick="resetDevice('${c.key}')">Reset</button>
<button class="small" onclick="toggle('${c.key}',${u.active})">On/Off</button>
<button class="small danger" onclick="delUser('${c.key}')">Hapus</button>
</td>
</tr>`;
  });
});

/* ===== CRUD ===== */
addForm.onsubmit=e=>{
  e.preventDefault();
  push(ref(db,"userList"),{
    username:u.value.toUpperCase(),
    storeId:s.value.toUpperCase(),
    expired:e.value,
    role:r.value,
    active:true
  });
  addForm.reset();
};

window.resetDevice=id=>update(ref(db,"userList/"+id),{deviceId:null});
window.toggle=(id,a)=>update(ref(db,"userList/"+id),{active:!a});
window.delUser=id=>confirm("Hapus user?")&&remove(ref(db,"userList/"+id));

window.logout=()=>{
  sessionStorage.clear();
  location.reload();
};
</script>

</body>
</html>
