<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#f2f6fb;
}
.hidden{display:none}

/* LOGIN */
.login-wrap{
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}
.login-card{
  background:#fff;
  padding:35px;
  width:320px;
  border-radius:12px;
  box-shadow:0 10px 30px rgba(0,0,0,.12);
  text-align:center;
}
.login-card h2{
  margin:0 0 20px;
}
.login-card input{
  width:100%;
  padding:12px;
  border-radius:8px;
  border:1px solid #ccc;
  font-size:15px;
}
.login-card button{
  margin-top:15px;
  width:100%;
  padding:12px;
  border:none;
  border-radius:8px;
  background:#1e88e5;
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

/* PANEL */
.container{
  max-width:1200px;
  margin:30px auto;
  padding:0 15px;
}
.card{
  background:#fff;
  border-radius:10px;
  padding:20px;
  box-shadow:0 4px 12px rgba(0,0,0,.08);
}
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
.badge{
  background:#e3f2fd;
  color:#1e88e5;
  padding:6px 14px;
  border-radius:20px;
  font-size:13px;
  font-weight:600;
}

/* FORM */
.flex{
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  align-items:center;
}
input,select,button{
  padding:8px;
  border-radius:6px;
  border:1px solid #ccc;
}
button{
  border:none;
  cursor:pointer;
  color:#fff;
  font-weight:600;
}
.success{background:#43a047}
.warning{background:#f9a825}
.secondary{background:#6b7280}
.danger{background:#e53935}

/* TABLE */
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e0e0e0;
  text-align:center;
  font-size:14px;
}
th{
  background:#f5f7fa;
}
.status-aktif{color:#16a34a;font-weight:600}
.status-expired{color:#dc2626;font-weight:600}
.small{font-size:12px;color:#666}

/* WELCOME */
.welcome{
  background:#f1f8ff;
  border-left:5px solid #1e88e5;
  padding:12px 15px;
  border-radius:6px;
  margin-bottom:15px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="login" class="login-wrap">
  <div class="login-card">
    <h2>üîê Admin Login</h2>
    <input id="pin" type="password" placeholder="Masukkan PIN Admin">
    <button onclick="loginAdmin()">LOGIN</button>
  </div>
</div>

<!-- PANEL -->
<div id="panel" class="hidden">
  <div class="container">

    <div class="welcome" id="greet"></div>

    <div class="card">

      <div class="header">
        <h3>üßë‚Äçüíº Manajemen User</h3>
        <span class="badge">Total: <span id="total">0</span></span>
      </div>

      <!-- ADD USER -->
      <div class="flex">
        <input id="u" placeholder="USERNAME" oninput="this.value=this.value.toUpperCase()">
        <input id="s" placeholder="STORE ID" oninput="this.value=this.value.toUpperCase()">
        <input id="d" type="number" placeholder="Masa Aktif (Hari)">
        <button class="success" onclick="addUser()">Tambah</button>
      </div>

      <!-- SEARCH & FILTER -->
      <div class="flex" style="margin-top:15px">
        <input id="search" placeholder="Cari user / store" oninput="render()">
        <select id="filter" onchange="render()">
          <option value="all">Semua</option>
          <option value="aktif">Aktif</option>
          <option value="expired">Expired</option>
        </select>
      </div>

      <!-- TABLE -->
      <table>
        <thead>
          <tr>
            <th>Store</th>
            <th>Expired</th>
            <th>Status</th>
            <th>Device</th>
            <th>Aksi</th>
          </tr>
        </thead>
        <tbody id="list"></tbody>
      </table>

      <button class="danger" style="margin-top:15px" onclick="logout()">Logout</button>
    </div>
  </div>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCld9VE6XdF-tbcv1E-gBZ2ACeJBklW-Go",
  authDomain: "server-laporan.firebaseapp.com",
  databaseURL: "https://server-laporan-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "server-laporan"
});
const db = firebase.database();

/* CONFIG */
const ADMIN_PIN="500000";
let USERS={};

/* LOGIN */
function loginAdmin(){
  if(pin.value!==ADMIN_PIN) return alert("PIN salah");
  login.classList.add("hidden");
  panel.classList.remove("hidden");
  greetAdmin();
  load();
}

/* GREETING */
function greetAdmin(){
  const h=new Date().getHours();
  let t="Selamat Datang";
  if(h<11)t="Selamat Pagi";
  else if(h<15)t="Selamat Siang";
  else if(h<18)t="Selamat Sore";
  else t="Selamat Malam";
  greet.innerHTML=`üëã <strong>${t}, Admin</strong><br>Semoga pekerjaan Anda lancar hari ini.`;
}

/* LOAD */
function load(){
  db.ref("userList").on("value",s=>{
    USERS=s.val()||{};
    total.innerText=Object.keys(USERS).length;
    render();
  });
}

/* ADD */
function addUser(){
  if(!u.value||!s.value||!d.value) return alert("Lengkapi data");
  const exp=new Date();
  exp.setDate(exp.getDate()+parseInt(d.value));
  db.ref("userList").push({
    username:u.value,
    storeId:s.value,
    expired:exp.toISOString().slice(0,10)
  });
  u.value=s.value=d.value="";
}

/* RENDER */
function render(){
  list.innerHTML="";
  const q=search.value.toLowerCase();
  const f=filter.value;
  const today=new Date().toISOString().slice(0,10);

  Object.keys(USERS).forEach(id=>{
    const u=USERS[id];
    const aktif=u.expired>=today;
    if(q && !u.storeId.toLowerCase().includes(q)) return;
    if(f==="aktif" && !aktif) return;
    if(f==="expired" && aktif) return;

    list.innerHTML+=`
    <tr>
      <td>${u.storeId}</td>
      <td>${u.expired}</td>
      <td class="${aktif?'status-aktif':'status-expired'}">${aktif?'Aktif':'Expired'}</td>
      <td>${u.deviceId?'üîí Locked':'üü¢ Free'}</td>
      <td>
        <button class="warning" onclick="extend('${id}','${u.expired}')">Edit</button>
        <button class="secondary" onclick="reset('${id}')">Reset</button>
        <button class="danger" onclick="del('${id}')">Hapus</button>
      </td>
    </tr>`;
  });
}

/* EXTEND */
function extend(id,exp){
  const add=prompt("Tambah masa aktif (hari):");
  if(!add) return;
  const base=new Date(exp>=new Date().toISOString().slice(0,10)?exp:new Date());
  base.setDate(base.getDate()+parseInt(add));
  db.ref("userList/"+id).update({expired:base.toISOString().slice(0,10)});
}

/* RESET */
function reset(id){
  if(confirm("Reset device user?"))
    db.ref("userList/"+id).update({deviceId:null,lastLogin:null});
}

/* DELETE */
function del(id){
  if(confirm("Hapus user?")) db.ref("userList/"+id).remove();
}

/* LOGOUT */
function logout(){location.reload();}
</script>

</body>
</html>
